Deadlock
---------------

* Deadlock : 프로세스들이 서로가 가진 자원을 기다리며 block된 상태
  * Resource : 하드웨어, 소프트웨어 등을 포함하는 개념
    * IO 디바이스, cpu cycle, memory space, semaphore...
  * 데드락 발생 조건
    * Mutual exclusion(상호배제)
      * 매 순간 하나의 프로세스만이 자원을 사용할 수 있음
    * No preemption(비선점)
      * 프로세스는 자원을 스스로 내어놓을뿐 강제로 빼앗기지 않음
    * Hold and wait(보유대기)
      * 자원을 가진 프로세스가 다른 자원을 기다릴 때 보유 자원을 놓지않고 계속 가지고 있음
    * Circular wait(순환대기)
      * 자원을 기다리는 프로세스간에 사이클이 형성되어야 함
  * 데드락 판단
    * 자원 할당 그래프에 사이클이 없으면 데드락이 아님
    * 사이클이 존재하고 자원당 하나의 인스턴스만 있을 경우 데드락이다.
    * 사이클이 존재하고 자원당 여러개의 인스턴스가 있다면 데드락의 가능성이 있다.
  * 데드락 처리 방법
    * Deadlock Prevention(데드락 예방)
      * 데드락의 발생 요건중 어느 하나가 만족되지 않게 하는것
        * Mutual Exclusion (상호 배제)
          * 공유해서는 안되는 자원의 경우 반드시 성립해야 함
        * Hold and Wait (보유 대기)
          * 프로세스가 자원을 요청할 때 다른 어떤 자원도 가지고 있지 않아야 한다.
          * 방법1. 프로세스가 시작시 필요한 자원을 전부 할당 받게 하는것
          * 방법2. 자원이 필요한 경우 보유 자원을 반납하고 다시 요청하는것
        * No Preemption (비선점)
          * 프로세스가 어떤 자원을 기다려야 하는 경우 이미 보유한 자원이 선점됨
          * 모든 필요한 자원을 얻을 수 있을 때 그 프로세스는 다시 시작됨
          * 상태를 쉽게 저장하고 복구할수 있는 cpu, memory에서 주로 사용됨
        * Circular Wait (순환 대기)
          * 모든 자원 유형에 할당 순서를 정하여 정해진 순서대로만 자원 할당
          * starvation 문제가 발생할 수 있음
    * Deadlock Avoidance (데드락 회피)
      * 프로세스의 자원 요청에 데드락의 가능성을 판단하여 안전할 때만 자원 할당
      * 프로세스가 필요로 하는 최대 자원의 양을 먼저 선언함
        * 자원 할당 알고리즘
          * 프로세스와 자원을 그래프로 만들어 프로세스가 자원 요청시 실선 요청 가능성은 점선으로 표시해 사이클이 생기지 않는 경우에만 자원 할당
        * 은행원 알고리즘
          * 데드락 가능성이 없는 안전상태와 있는 불안전상태로 나누어 판단한다.
          * 안전 상태를 유지할 수 있는 프로세스의 요청만 수락하고 불안전 상태를 초래할 수 있는 요청은 만족될 상황까지 거절
            * 안전 상태란 데드락이 발생하지 않으면서 최소 하나의 프로세스의 요청에 최대의 자원을 할당해 줄 수 있는 상태로 안전 순서열이 만들어짐
            * 불안전 상태란 안전 순서열이 존재하지 않는 상태. 데드락은 불안전 상태에서만 발생하지만 불안전 상태라고 해서 무조건 데드락이 발생하는것은 아님
          * 은행원 알고리즘의 필요
            * 각 프로세스의 최대 자원 요구치
            * 각 프로세스에게 현재 할당된 자원의 양
            * 시스템의 자원 보유량
          * 은행원 알고리즘의 단점
            * 할당 가능한 자원의 수가 일정해야 함
            * 프로세스의 수가 일정해야 함
            * 데드락을 방지하기 위해 자원 이용의 효율성이 떨어짐
            * 최대 자원 요구량을 미리 알아야 함
            * 프로세스들은 유한한 시간 안에 자원을 반납해야 함
    * Deadlock Detection and recovery (데드락 탐지 및 회복)
      * 데드락의 탐지
        * 자원 유형당 하나의 인스턴스만 존재한다면 wait-for 그래프 알고리즘을 이용해 탐지
        * 자원 유형당 여러개의 인스턴스가 존재한다면 은행원 알고리즘을 변형하여 탐지
      * 데드락의 회복
        * 프로세스 종료
          * 모든 데드락 상태의 프로세스를 종료
          * 데드락이 없어질 때까지 하나씩 프로세스를 종료
        * 자원 선점
          * 비용을 최소화 할 프로세스를 선정하고 안전 상태로 롤백하여 프로세스 재시작
          * 같은 프로세스가 계속 선정되어 starvation 문제가 발생할 수 있음
    * Deadlock Ignorance (데드락 무시)
      * 데드락은 자주 일어나는 이벤트가 아니므로 데드락에 아무런 조치를 취하지 않음
      * 데드락이 발생한 경우 사용자가 이를 알아채 해결하게 함
      * Unix와 Windows 등 대부분의 os에서 사용하는 방식